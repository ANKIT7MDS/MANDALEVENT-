<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>BJP ‡§Æ‡§Ç‡§°‡§≤ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root {
      --main: #e65100;
      --main-dark: #bf360c;
      --accent: #fffde7;
      --green: #388e3c;
      --red: #c62828;
      --popup-bg: rgba(0,0,0,0.5);
    }
    body {margin:0; font-family: 'Segoe UI', sans-serif; background: var(--accent);}
    header {background: linear-gradient(90deg, var(--main), var(--main-dark));color:white;padding:24px 0 18px 0;text-align:center;font-size:2rem;letter-spacing:1px;box-shadow:0 4px 12px rgba(230,81,0,0.07);}
    nav {display:flex;justify-content:center;background:white;box-shadow:0 2px 8px rgba(0,0,0,0.04);}
    nav button {flex:1;padding:16px 0;border:none;font-size:17px;cursor:pointer;background:transparent;transition:background 0.2s,color 0.2s;color:var(--main-dark);font-weight:500;}
    nav button.active,nav button:hover {background:var(--main);color:#fff;font-weight:bold;}
    .container {max-width:650px;margin:40px auto 0 auto;background:#fff;border-radius:15px;box-shadow:0 2px 20px rgba(0,0,0,0.10);padding:34px 24px 30px 24px;min-height:350px;}
    @media (max-width:700px){.container{margin:24px 4px 0 4px;padding:18px 4vw;}nav{flex-direction:column;}nav button{border-bottom:1px solid #eee;}}
    h2 {margin-top:0;color:var(--main-dark);font-size:1.38rem;margin-bottom:20px;letter-spacing:1px;}
    input,select,textarea {width:100%;padding:11px 9px;margin-bottom:17px;border-radius:6px;border:1px solid #ddd;font-size:1rem;}
    input:focus,select:focus,textarea:focus {border:1.6px solid var(--main);outline:none;background:#fff8f0;}
    textarea {min-height:55px;}
    button.submit {background:var(--main-dark);color:#fff;padding:11px 0;width:100%;font-size:1.08rem;border:none;border-radius:7px;margin-top:10px;font-weight:bold;letter-spacing:1px;cursor:pointer;}
    button.submit:hover {background:#d84315;}
    .status-yes {color:var(--green);font-weight:bold;}
    .status-no {color:var(--red);font-weight:bold;}
    .file-upload {margin-bottom:15px;}
    table {width:100%;border-collapse:collapse;margin-bottom:13px;font-size:1rem;margin-top:20px;background:#f8f5f1;border-radius:8px;overflow:hidden;}
    th,td {border:1px solid #f1e7d3;padding:8px 10px;text-align:left;}
    th {background:#ffe0b2;color:var(--main-dark);}
    .actions button {padding:3px 7px;font-size:16px;margin-right:2px;border-radius:4px;border:none;background:#eee;color:var(--main-dark);cursor:pointer;}
    .actions button:hover {background:var(--main);color:#fff;}
    .hidden {display:none;}
    #reportModal {display:none; position:fixed; left:0;top:0;width:100vw;height:100vh;z-index:100;background:var(--popup-bg);align-items:center;justify-content:center;}
    #reportModal.active {display:flex; animation: fadePopup 0.5s;}
    @keyframes fadePopup {0%{opacity:0;transform:translateY(60px) scale(0.92);}100%{opacity:1;transform:none;}}
    #reportModalContent {background:white;max-width:440px;width:96vw;padding:28px 18px 18px 18px;border-radius:14px;position:relative;box-shadow:0 8px 48px rgba(0,0,0,0.16);}
    #reportModalContent img {max-width:85px;max-height:70px;margin:4px;border-radius:8px;border:1.2px solid #eee;cursor:pointer;transition:transform .22s;}
    #reportModalContent img:hover {transform:scale(1.1);}
    #reportModalContent h3{margin:0 0 10px 0;}
    #reportModal button.close {position:absolute;top:10px;right:12px;font-size:21px;border:none;background:none;cursor:pointer;}
    #alertBox {position:fixed;top:32px;right:23px;z-index:999;background:#e65100;color:#fff;padding:13px 23px;border-radius:9px;font-size:1.09rem;display:none;box-shadow:0 8px 24px rgba(230,81,0,0.15);}
    #alertBox.success {background:#388e3c;}
    #alertBox.error {background:#c62828;}
  </style>
</head>
<body>
<div id="alertBox"></div>
<header>BJP ‡§Æ‡§Ç‡§°‡§≤ ‡§á‡§µ‡•á‡§Ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§Æ‡•á‡§Ç‡§ü</header>
<nav>
  <button onclick="switchTab('dashboard', event)" class="active">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</button>
  <button onclick="switchTab('schedule', event)">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£</button>
  <button onclick="switchTab('coordinators', event)">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï</button>
  <button onclick="switchTab('report', event)">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</button>
</nav>
<!-- ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° Tab -->
<div class="container tab" id="dashboard">
  <h2>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h2>
  <input type="text" id="eventNameInput" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <button class="submit" onclick="addEvent()">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
  <div style="margin-bottom:7px; margin-top:14px;">
    <button onclick="exportTableToCSV('events.csv')">CSV Export</button>
    <button onclick="exportTableToPDF()">PDF Export</button>
  </div>
  <h2>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä</h2>
  <table>
    <thead>
      <tr>
        <th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th>
        <th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
        <th>‡§∏‡§Æ‡§Ø</th>
        <th>‡§∏‡•ç‡§•‡§æ‡§®</th>
        <th>‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï</th>
        <th>‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü</th>
        <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
      </tr>
    </thead>
    <tbody id="eventTableBody">
      <tr><td colspan="7" style="text-align:center;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>
    </tbody>
  </table>
  <h2>‡§∏‡§¨‡§Æ‡§ø‡§ü‡•á‡§° ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≤‡§ø‡§∏‡•ç‡§ü</h2>
  <table id="reportTable">
    <thead>
      <tr>
        <th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</th>
        <th>‡§Æ‡§Ç‡§°‡§≤</th>
        <th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th>
        <th>‡§∏‡§Æ‡§Ø</th>
        <th>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø</th>
        <th>‡§´‡•ã‡§ü‡•ã</th>
        <th>‡§è‡§ï‡•ç‡§∂‡§®</th>
      </tr>
    </thead>
    <tbody id="reportTableBody">
      <tr><td colspan="7" style="text-align:center;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>
    </tbody>
  </table>
</div>
<!-- ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£ Tab -->
<div class="container tab hidden" id="schedule">
  <h2>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç</h2>
  <select id="scheduleEventSelect"><option selected disabled>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</option></select>
  <input type="date" id="eventDate">
  <input type="time" id="eventTime">
  <input type="text" id="eventLocation" placeholder="‡§∏‡•ç‡§•‡§æ‡§®">
  <button class="submit" onclick="saveEventDetails()">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
</div>
<!-- ‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï Tab -->
<div class="container tab hidden" id="coordinators">
  <h2>‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h2>
  <select id="coordinatorEventSelect"><option selected disabled>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</option></select>
  <input type="text" id="co1" placeholder="‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 1 ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input type="text" id="co1m" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
  <input type="text" id="co2" placeholder="‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 2 ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input type="text" id="co2m" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
  <input type="text" id="co3" placeholder="‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï 3 ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input type="text" id="co3m" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞">
  <button class="submit" onclick="saveCoordinators()">‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
</div>
<!-- ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü Tab: ‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§´‡•â‡§∞‡•ç‡§Æ -->
<div class="container tab hidden" id="report">
  <h2>‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç</h2>
  <select id="reportEventSelect"><option selected disabled>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</option></select>
  <input type="text" id="mandal" placeholder="‡§Æ‡§Ç‡§°‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
  <input type="text" id="guests" placeholder="‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Ö‡§§‡§ø‡§•‡§ø (1 ‡§∏‡•á 6, ‡§ï‡•â‡§Æ‡§æ ‡§∏‡•á)">
  <input type="date" id="reportDate">
  <input type="time" id="reportTime">
  <input type="text" id="reportLocation" placeholder="‡§∏‡•ç‡§•‡§æ‡§®">
  <input type="number" id="attendance" placeholder="‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ">
  <input class="file-upload" type="file" id="reportPhotos" multiple>
  <textarea id="notes" placeholder="‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä"></textarea>
  <button class="submit" onclick="submitReport()">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
</div>
<!-- Report Detail Modal -->
<div id="reportModal">
  <div id="reportModalContent">
    <button onclick="closeReportModal()" class="close">&times;</button>
    <div id="reportDetailBox"></div>
  </div>
</div>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCI1EL8iFVJnOWbd58Bq5JrJg_IgZuCvA0",
  authDomain: "mandaleventall.firebaseapp.com",
  projectId: "mandaleventall",
  storageBucket: "mandaleventall.firebasestorage.app",
  messagingSenderId: "900190130114",
  appId: "1:900190130114:web:bc7d9e2283b3ac57bc505b",
  measurementId: "G-2BBZZNRS88"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();
const botToken = "8064306737:AAFvXvc3vIT1kyccGiPbpYGCAr9dgKJcRzw";
const chatId = "733804072";
function showAlert(msg, type='normal') {
  let box = document.getElementById('alertBox');
  box.innerText = msg;
  box.className = (type==='success'?'success':(type==='error'?'error':''));
  box.style.display = 'block';
  setTimeout(()=>{box.style.display='none';}, 2500);
}
function switchTab(tabId, e) {
  document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(tab => tab.classList.add('hidden'));
  document.getElementById(tabId).classList.remove('hidden');
  if (e) e.target.classList.add('active');
  if(tabId==='dashboard'){ loadReports(); }
  if(['schedule','coordinators','report'].includes(tabId)) populateEventDropdowns();
}
async function addEvent() {
  const eventName = document.getElementById('eventNameInput').value.trim();
  if (!eventName) return showAlert("‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≠‡§∞‡•á‡§Ç!","error");
  await db.collection('events').add({name: eventName, createdAt: new Date()});
  document.getElementById('eventNameInput').value = '';
  loadEvents();
  populateEventDropdowns();
  showAlert("‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ú‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!","success");
}
async function loadEvents() {
  const tbody = document.getElementById('eventTableBody');
  tbody.innerHTML = "<tr><td colspan='7' style='text-align:center;'>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>";
  const snap = await db.collection('events').orderBy("createdAt").get();
  tbody.innerHTML = "";
  snap.forEach(doc => {
    const e = doc.data();
    tbody.innerHTML += `<tr>
      <td>${e.name}</td>
      <td>${e.date||'-'}</td>
      <td>${e.time||'-'}</td>
      <td>${e.location||'-'}</td>
      <td>${(e.coordinators||[]).map(c=>c.name).join(', ')||'-'}</td>
      <td>${e.reported?"<span class='status-yes'>‚úÖ ‡§Ü‡§Ø‡•Ä</span>":"<span class='status-no'>‚ùå ‡§®‡§π‡•Ä‡§Ç</span>"}</td>
      <td class="actions"><button title="Delete" onclick="deleteEvent('${doc.id}')">üóëÔ∏è</button></td>
    </tr>`;
  });
}
async function populateEventDropdowns() {
  const snap = await db.collection('events').orderBy("createdAt").get();
  ['scheduleEventSelect','coordinatorEventSelect','reportEventSelect'].forEach(id=>{
    const sel = document.getElementById(id);
    sel.innerHTML = `<option selected disabled>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§ö‡•Å‡§®‡•á‡§Ç</option>`;
    snap.forEach(doc => sel.innerHTML += `<option value="${doc.id}">${doc.data().name}</option>`);
  });
}
async function saveEventDetails() {
  const eventId = document.getElementById('scheduleEventSelect').value;
  const date = document.getElementById('eventDate').value;
  const time = document.getElementById('eventTime').value;
  const location = document.getElementById('eventLocation').value.trim();
  if(!eventId||!date||!time||!location) return showAlert("‡§™‡•Ç‡§∞‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç!","error");
  await db.collection('events').doc(eventId).update({date,time,location});
  showAlert("‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!","success");
  loadEvents();
}
async function saveCoordinators() {
  const eventId = document.getElementById('coordinatorEventSelect').value;
  const c = [
    {name:document.getElementById('co1').value.trim(),mobile:document.getElementById('co1m').value.trim()},
    {name:document.getElementById('co2').value.trim(),mobile:document.getElementById('co2m').value.trim()},
    {name:document.getElementById('co3').value.trim(),mobile:document.getElementById('co3m').value.trim()}
  ].filter(x=>x.name&&x.mobile);
  if(!eventId||c.length===0) return showAlert("‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç!","error");
  await db.collection('events').doc(eventId).update({coordinators:c});
  showAlert("‡§∏‡§Ç‡§Ø‡•ã‡§ú‡§ï ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§è!","success");
  loadEvents();
}
async function sendTelegramAlert(msg) {
  const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
  await fetch(url, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({chat_id: chatId, text: msg})
  });
}
async function submitReport() {
  const eventId = document.getElementById('reportEventSelect').value;
  const mandal = document.getElementById('mandal').value.trim();
  const guests = document.getElementById('guests').value.trim();
  const date = document.getElementById('reportDate').value;
  const time = document.getElementById('reportTime').value;
  const location = document.getElementById('reportLocation').value.trim();
  const attendance = document.getElementById('attendance').value;
  const notes = document.getElementById('notes').value.trim();
  const files = document.getElementById('reportPhotos').files;
  if(!eventId||!mandal||!date||!time||!location) return showAlert("‡§∏‡§≠‡•Ä ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç!","error");
  let photoURLs = [];
  for(let i=0;i<files.length && i<10;i++) {
    const ref = storage.ref('reports/'+Date.now()+'_'+files[i].name);
    await ref.put(files[i]);
    const url = await ref.getDownloadURL();
    photoURLs.push(url);
  }
  await db.collection('reports').add({eventId, mandal, guests, date, time, location, attendance, photoURLs, notes, submittedAt: new Date()});
  await db.collection('events').doc(eventId).update({reported:true});
  loadEvents();
  let alertMsg = `üö® *‡§®‡§à ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§Ü‡§Ø‡•Ä!*
‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ: ${eventMap[eventId]||eventId}
‡§Æ‡§Ç‡§°‡§≤: ${mandal}
‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ${attendance}`;
  sendTelegramAlert(alertMsg);
  showAlert("‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§π‡•ã ‡§ó‡§à!","success");
  loadReports();
}
async function deleteEvent(id) {
  if(!confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
  await db.collection('events').doc(id).delete();
  loadEvents(); populateEventDropdowns();
}
const eventMap = {};
async function buildEventMap() {
  const snap = await db.collection('events').get();
  snap.forEach(doc=>{eventMap[doc.id]=doc.data().name});
}
async function loadReports() {
  const tbody = document.getElementById('reportTableBody');
  tbody.innerHTML = "<tr><td colspan='7' style='text-align:center;'>‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</td></tr>";
  await buildEventMap();
  const snap = await db.collection('reports').orderBy("submittedAt", "desc").get();
  tbody.innerHTML = "";
  snap.forEach(doc => {
    const r = doc.data();
    tbody.innerHTML += `<tr class="animated">
      <td>${eventMap[r.eventId]||r.eventId}</td>
      <td>${r.mandal||"-"}</td>
      <td>${r.date||"-"}</td>
      <td>${r.time||"-"}</td>
      <td>${r.attendance||"-"}</td>
      <td>${(r.photoURLs||[]).length>0 ? `<button onclick="window.open('${r.photoURLs[0]}')">‡§¶‡•á‡§ñ‡•á‡§Ç</button>` : "-"}</td>
      <td><button onclick="viewReport('${doc.id}')">üëÅÔ∏è</button></td>
    </tr>`;
  });
}
async function viewReport(id) {
  const doc = await db.collection('reports').doc(id).get();
  if(!doc.exists) return showAlert("‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä!","error");
  const r = doc.data();
  let html = `
    <h3 style="color:#e65100; margin:0 0 10px 0;">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ: ${eventMap[r.eventId]||'-'}</h3>
    <div><b>‡§Æ‡§Ç‡§°‡§≤:</b> ${r.mandal||'-'}</div>
    <div><b>‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§Ö‡§§‡§ø‡§•‡§ø:</b> ${r.guests||'-'}</div>
    <div><b>‡§§‡§æ‡§∞‡•Ä‡§ñ:</b> ${r.date||'-'} <b>‡§∏‡§Æ‡§Ø:</b> ${r.time||'-'}</div>
    <div><b>‡§∏‡•ç‡§•‡§æ‡§®:</b> ${r.location||'-'}</div>
    <div><b>‡§â‡§™‡§∏‡•ç‡§•‡§ø‡§§‡§ø:</b> ${r.attendance||'-'}</div>
    <div><b>‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:</b> ${r.notes||'-'}</div>
    <div style="margin:14px 0 7px 0;"><b>‡§´‡•ã‡§ü‡•ã (${(r.photoURLs||[]).length}):</b><br>
      ${(r.photoURLs||[]).map(url=>`<img src="${url}" title="‡§¨‡§°‡§º‡§æ ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç" onclick="window.open('${url}')" >`).join('')}
    </div>
    <div><b>Submitted:</b> ${r.submittedAt?.toDate?.().toLocaleString?.() || '-'}</div>
  `;
  document.getElementById('reportDetailBox').innerHTML = html;
  document.getElementById('reportModal').classList.add('active');
}
function closeReportModal() {
  document.getElementById('reportModal').classList.remove('active');
}
function exportTableToCSV(filename) {
  const table = document.querySelector('#eventTableBody').parentNode;
  let csv = [];
  for(let row of table.rows) {
    let rowData = [];
    for(let cell of row.cells) {
      rowData.push('"' + cell.innerText.replace(/"/g, '""') + '"');
    }
    csv.push(rowData.join(','));
  }
  let csvStr = csv.join("\\n");
  let blob = new Blob([csvStr], { type: "text/csv" });
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
function exportTableToPDF() {
  const table = document.querySelector('#eventTableBody').parentNode;
  html2pdf().from(table).set({
    margin: 0.2,
    filename: 'events.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
  }).save();
}
window.onload = () => {
  loadEvents();
  populateEventDropdowns();
  loadReports();
};
</script>
</body>
</html>
'''

